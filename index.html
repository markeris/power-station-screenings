<!DOCTYPE html>
<html>
<head>
  <title>UK Cinema Screenings</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  
  <style>
    body, html { margin: 0; padding: 0; }
    #map { height: 100vh; width: 100%; }
  </style>
</head>
<body>

<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
  const map = L.map('map').setView([54.5, -3], 6);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  // Marker for CURRENT screenings (coral)
  const coralMarker = L.divIcon({
    className: 'custom-marker',
    html: `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="45" viewBox="0 0 32 45">
             <path fill="#fe8768" d="M16 0C7 0 0 7 0 16c0 12 16 29 16 29s16-17 16-29c0-9-7-16-16-16zm0 24a8 8 0 1 1 0-16 8 8 0 0 1 0 16z"/>
           </svg>`,
    iconSize: [32, 45],
    iconAnchor: [16, 45],
    popupAnchor: [0, -45]
  });

  // Marker for PAST screenings (#899499)
  const pastMarker = L.divIcon({
    className: 'custom-marker',
    html: `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="45" viewBox="0 0 32 45">
             <path fill="#899499" d="M16 0C7 0 0 7 0 16c0 12 16 29 16 29s16-17 16-29c0-9-7-16-16-16zm0 24a8 8 0 1 1 0-16 8 8 0 0 1 0 16z"/>
           </svg>`,
    iconSize: [32, 45],
    iconAnchor: [16, 45],
    popupAnchor: [0, -45]
  });

  // Fetch screening data from Google Sheet
  fetch('https://script.google.com/macros/s/AKfycbxCLarLw07AqPCnJmL_kbzCn9ETwt7MXIqoBUSUxmUWOMlY8GJ3iONFZ4cb3gdAr-QI/exec')
    .then(res => res.json())
    .then(data => {
      console.log('Fetched data:', data);

      if (!Array.isArray(data)) {
        console.error('Expected an array, but got:', data);
        return;
      }

      data.forEach(s => {
        const lat = parseFloat(s.Latitude);
        const lng = parseFloat(s.Longitude);
        const status = (s.Status || '').trim().toUpperCase();

        if (!isNaN(lat) && !isNaN(lng)) {
          const markerIcon = status === 'PAST' ? pastMarker : coralMarker;

          L.marker([lat, lng], { icon: markerIcon })
            .addTo(map)
            .bindPopup(
              `<strong>${s.cinemaname || ''}</strong><br>
              ${s.screeningdate || ''}<br>
              ${s.URL ? `<a href="${s.URL}" target="_blank">More Details</a>` : 'No URL available'}`
            );
        } else {
          console.warn('Skipping invalid coordinates for', s.cinemaname, s.Latitude, s.Longitude);
        }
      });
    })
    .catch(err => console.error('Error fetching data:', err));
</script>

</body>
</html>



